function parseMarkdown(e){if(!e)return"";function t(e){return e?(console.log(e),(e=(e=(e=(e=(e=(e=(e=(e=(e=e.replace(/!\[([^\]]*)\]\(([^)]+)\)/g,(e,t,l)=>{console.log(l);let r=/\.(jpe?g|png|gif|webp|bmp|svg)$/i.test(l.split("?")[0]);if(r)return`<a href="${l}" target="_blank" rel="noopener noreferrer"><img src="${l}" alt="${t||""}" class="user-uploaded-image" loading="lazy"></a>`})).replace(/\[([^\]]+)\]\(([^)]+)\)/g,'<a href="$2" target="_blank" rel="noopener noreferrer">$1</a>')).replace(/<((?:https?:\/\/|www\.)[^\s<>]+)>/g,(e,t)=>{t=t.replace(/\([\(\)\[\]]\)/g,"$1").replace(/^<|>$/g,"").trim();let l=t.startsWith("http")?t:`http://${t}`;return`<a href="${l}" target="_blank" rel="noopener noreferrer">${t}</a>`})).replace(/(?<!["'])(https?:\/\/[^\s<>\)\]\{\}\|`]+)/g,e=>{if(e.match(/<[^>]*$/))return e;let t=e.startsWith("http")?e:`http://${e}`;return`<a href="${t}" target="_blank" rel="noopener noreferrer">${e}</a>`})).replace(/\*\*([^*]+?)\*\*|__([^_]+?)__/g,"<strong>$1$2</strong>")).replace(/\*([^*]+?)\*|_([^_]+?)_/g,"<em>$1$2</em>")).replace(/~~([^~]+)~~/g,"<del>$1</del>")).replace(/\|\|([^|]+)\|\|/g,'<span class="spoiler">$1</span>')).replace(/`([^`]+)`/g,'<code class="inline-code">$1</code>')).replace(/<\/em>|<em>/g,"_")):""}function l(e,t=""){if(!e)return"";let l=t?` class="language-${t}"`:"";return`<pre><code${l}>${escapeHtml(e)}</code></pre>`}let r=e.split("\n"),s=[],p=!1,a=!1,u=!1,n=!1,h=[],c="";for(let i=0;i<r.length;i++){let o=r[i].trim();if(o.startsWith("```")){n?(s.push(l(h.join("\n"),c)),n=!1,h=[],c=""):(n=!0,c=o.substring(3).trim());continue}if(n){h.push(o);continue}if("---"===o||"***"===o){s.push("<hr>");continue}if(!o){s.push("");continue}if(o.startsWith(">")){let g=o.substring(1).trim();if(g.match(/^(\d+\.|[-*+])\s+/),!u&&(p?(s.push("</ol>"),p=!1):a&&(s.push("</ul>"),a=!1),s.push("<blockquote>"),u=!0,g.match(/^\d+\.\s+/)?(s.push('<ol start="1">'),p=!0):g.match(/^[-*+]\s+/)&&(s.push("<ul>"),a=!0)),g.match(/^\d+\.\s+/)){p||(a&&(s.push("</ul>"),a=!1),s.push('<ol start="1">'),p=!0);let _=g.replace(/^\d+\.\s*/,"");s.push(`<li data-text="1.">${escapeHtml(_)}</li>`)}else if(g.match(/^[-*+]\s+/)){p?(s.push("</ol>"),p=!1):a&&(s.push("</ul>"),a=!1);let m=g.replace(/^[-*+]\s*/,"");s.push(`<li data-text="-">${escapeHtml(m)}</li>`)}else p?(s.push("</ol>"),p=!1):a&&(s.push("</ul>"),a=!1),s.push(`<p>${escapeHtml(g)}</p>`);(i===r.length-1||!r[i+1].trim().startsWith(">"))&&(p?(s.push("</ol>"),p=!1):a&&(s.push("</ul>"),a=!1),u&&(s.push("</blockquote>"),u=!1));continue}if(o.match(/^\d+\.\s+/)){p||(a&&(s.push("</ul>"),a=!1),s.push("<ol>"),p=!0);let f=o.replace(/^\d+\.\s*/,"");s.push(`<li data-text="${o.match(/^\d+/)[0]}.">${escapeHtml(f)}</li>`);continue}if(o.match(/^[-*+]\s+/)){a||(p&&(s.push("</ol>"),p=!1),s.push("<ul>"),a=!0);let d=o.replace(/^[-*+]\s*/,"");s.push(`<li data-text="-">${escapeHtml(d)}</li>`);continue}p?(s.push("</ol>"),p=!1):a&&(s.push("</ul>"),a=!1);let b=o.match(/^(#{1,6})\s+(.*)$/);if(b){let $=b[1].length,k=b[2].trim();s.push(`<h${$}>${t(k)}</h${$}>`);continue}s.push(`<p>${t(o)}</p>`)}return p&&s.push("</ol>"),a&&s.push("</ul>"),u&&s.push("</blockquote>"),n&&s.push(l(h.join("\n"),c)),s.join("\n")}function escapeHtml(e){return e?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"):""}